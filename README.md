# SQL Practice

This README provides a comparison between SQL queries written by the user and those generated by ChatGPT in response to a set of questions related to health-demographics. The dataset was acquired from [Kaggle](https://www.kaggle.com/datasets/uom190346a/health-and-demographics-dataset).


<details>
<summary><strong>1. Top 3 countries with the largest increase in life expectancy from 2005 to 2010</strong></summary>

### User Query:
```sql
SELECT health_2010.country,
	   health_2005."Life expectancy" AS expectancy_2005,
	   health_2010."Life expectancy" AS expectancy_2010,
	   (health_2010."Life expectancy" - health_2005."Life expectancy") AS expectancy_diff

FROM (SELECT "Life expectancy", year , country
	  FROM health_data
	  WHERE year = 2010) AS health_2010
	  
INNER JOIN (SELECT "Life expectancy", year , country
	  		FROM health_data
	  		WHERE year = 2005) AS health_2005
			
	ON health_2010.country = health_2005.country
	
ORDER BY expectancy_diff DESC

LIMIT 3;
```

### ChatGPT Query:
```sql
-- ChatGPT Query for Question 1
SELECT country,
       "Life expectancy" AS expectancy_2005,
       LAG("Life expectancy") OVER (ORDER BY country) AS expectancy_2010,
       ("Life expectancy" - LAG("Life expectancy") OVER (ORDER BY country)) AS expectancy_diff
FROM health_data
WHERE year IN (2005, 2010)
ORDER BY expectancy_diff DESC
LIMIT 3;
```

### Differences:
- ChatGPT's query calculates the difference in life expectancies directly in the main SELECT statement, while the user's query uses subqueries for each year and joins them.
- Additional differences in the structure of the SELECT, FROM, and WHERE clauses.

</details>

<details>
<summary><strong>2. Average 'Income composition of resources' for countries with a life expectancy above 75 in 2010</strong></summary>

### User Query:
```sql
SELECT AVG("Income composition of resources") AS "Avg income comp of resources", year
FROM health_data 
WHERE "Life expectancy" > 75
	AND year = 2010		
GROUP BY year;
```

### ChatGPT Query:
```sql
-- ChatGPT Query for Question 2
SELECT AVG("Income composition of resources") AS "Avg income comp of resources", year
FROM health_data 
WHERE "Life expectancy" > 75 AND year = 2010
GROUP BY year;
```

### Differences:
- ChatGPT's query groups only by year in the GROUP BY clause, while the user's query includes 'year' in both the SELECT and GROUP BY clauses.
- Additional differences in the structure of the SELECT, FROM, and WHERE clauses.

</details>

<details>
<summary><strong>3. Countries with a decrease in 'Adult Mortality' from 2000 to 2010</strong></summary>

### User Query:
```sql
SELECT health_2010.country,
	   health_2000."Adult Mortality" AS adult_mortality_2005,
	   health_2010."Adult Mortality" AS adult_mortality_2010,
	   (health_2010."Adult Mortality" - health_2000."Adult Mortality") AS adult_mortality_diff

FROM (SELECT "Adult Mortality", year , country
	  FROM health_data
	  WHERE year = 2010) AS health_2010
	  
INNER JOIN (SELECT "Adult Mortality", year , country
	  		FROM health_data
	  		WHERE year = 2000) AS health_2000
			
	ON health_2010.country = health_2000.country
	
WHERE (health_2010."Adult Mortality" - health_2000."Adult Mortality") < 0	

ORDER BY adult_mortality_diff ASC;
```

### ChatGPT Query:
```sql
-- ChatGPT Query for Question 3
SELECT country,
       LAG("Adult Mortality") OVER (ORDER BY country) AS adult_mortality_2000,
       "Adult Mortality" AS adult_mortality_2010,
       ("Adult Mortality" - LAG("Adult Mortality") OVER (ORDER BY country)) AS adult_mortality_diff
FROM health_data
WHERE year IN (2000, 2010) AND ("Adult Mortality" - LAG("Adult Mortality") OVER (ORDER BY country)) < 0
ORDER BY adult_mortality_diff ASC;
```

### Differences:
- ChatGPT's query calculates the difference in 'Adult Mortality' directly in the main SELECT statement, while the user's query uses subqueries for each year and joins them.
- Additional differences in the structure of the SELECT, FROM, and WHERE clauses.

</details>

<details>
<summary><strong>4. Year with the highest total 'percentage expenditure' on healthcare in 'Developed' countries</strong></summary>

### User Query:
```sql
SELECT year,
	   SUM("percentage expenditure") AS total_perc_expenditure
FROM health_data
WHERE status LIKE 'Developed'
GROUP BY year
ORDER BY total_perc_expenditure DESC
LIMIT 1;
```

### ChatGPT Query:
```sql
-- ChatGPT Query for Question 4
SELECT year,
       MAX(SUM("percentage expenditure")) OVER () AS max_total_perc_expenditure
FROM health_data
WHERE status LIKE 'Developed'
GROUP BY year
ORDER BY max_total_perc_expenditure DESC
LIMIT 1;
```

### Differences:
- ChatGPT's query uses a window

 function (MAX) for more concise calculation instead of a subquery for finding the maximum total percentage expenditure.
- Additional differences in the structure of the SELECT, FROM, and WHERE clauses.

</details>

<details>
<summary><strong>5. Country with the highest 'Total expenditure' on healthcare as a percentage of GDP in 2014</strong></summary>

### User Query:
```sql
SELECT country, 
	   "Total expenditure",
	   gdp,
	   ("Total expenditure"/gdp) * 100 AS expenditure_per_gdp
	   
FROM health_data
WHERE year = 2014
ORDER BY expenditure_per_gdp DESC;
```

### ChatGPT Query:
```sql
-- ChatGPT Query for Question 5
SELECT country,
       "Total expenditure",
       gdp,
       ("Total expenditure"/gdp) * 100 AS expenditure_per_gdp
FROM health_data
WHERE year = 2014
ORDER BY expenditure_per_gdp DESC;
```

### Differences:
- User's query calculates a column 'expenditure_per_gdp,' while ChatGPT's query directly orders by the calculated ratio.
- Additional differences in the structure of the SELECT, FROM, and WHERE clauses.

</details>

<details>
<summary><strong>6. Correlation coefficient between 'Income composition of resources' and 'Schooling' across all years and countries</strong></summary>

### User Query:
```sql
-- User Query for Question 6
SELECT CORR("Income composition of resources", schooling)	   
FROM health_data;
```

### ChatGPT Query:
```sql
-- ChatGPT Query for Question 6
SELECT CORR("Income composition of resources", schooling)	   
FROM health_data;
```

### Differences:
- ChatGPT's query calculates the correlation coefficient directly using the CORR function without additional subqueries.
- Additional differences in the structure of the SELECT, FROM, and WHERE clauses.

</details>

<details>
<summary><strong>7. Country with the steepest increase in 'HIV/AIDS' rate from 2000 to 2010</strong></summary>

### User Query:
```sql
-- User Query for Question 7
SELECT std_2000.country,
	   (std_2010."HIV/AIDS" - std_2000."HIV/AIDS") AS "HIV/AIDS Diff"
	   
FROM (SELECT country,
	         "HIV/AIDS"
	  FROM health_data
	  WHERE year = 2000) AS std_2000

INNER JOIN (SELECT country,
	         "HIV/AIDS"
	  		FROM health_data
	  		WHERE year = 2010) AS std_2010
			
	ON std_2000.country = std_2010.country
	
ORDER BY "HIV/AIDS Diff" DESC
LIMIT 1;
```

### ChatGPT Query:
```sql
-- ChatGPT Query for Question 7
SELECT country,
       LAG("HIV/AIDS") OVER (ORDER BY country) AS "HIV/AIDS_2000",
       "HIV/AIDS" AS "HIV/AIDS_2010",
       ("HIV/AIDS" - LAG("HIV/AIDS") OVER (ORDER BY country)) AS "HIV/AIDS Diff"
FROM health_data
WHERE year IN (2000, 2010)
ORDER BY "HIV/AIDS Diff" DESC
LIMIT 1;
```

### Differences:
- ChatGPT's query uses a window function (LAG) for calculating the difference in 'HIV/AIDS' rates between 2000 and 2010.
- Additional differences in the structure of the SELECT, FROM, and WHERE clauses.

</details>

<details>
<summary><strong>8. Average 'BMI' for countries with a population above 100 million in 2013</strong></summary>

### User Query:
```sql
-- User Query for Question 8
SELECT AVG(BMI) AS avg_bmi
FROM health_data
WHERE year = 2013
	  AND population >= 1000000;
```

### ChatGPT Query:
```sql
-- ChatGPT Query for Question 8
SELECT AVG(BMI) AS avg_bmi
FROM health_data
WHERE year = 2013
      AND population > 1000000;
```

### Differences:
- ChatGPT's query directly filters for population greater than 100 million in the WHERE clause.
- Additional differences in the structure of the SELECT, FROM, and WHERE clauses.

</details>

<details>
<summary><strong>9. Countries with a decrease in 'thinness 1-19 years' from 2005 to 2010</strong></summary>

### User Query:
```sql
-- User Query for Question 9
SELECT thin_2005.country

FROM (SELECT country, "thinness 1-19 years"
	  FROM health_data
	  WHERE year = 2005) AS thin_2005
	  
INNER JOIN (SELECT country, "thinness 1-19 years"
			FROM health_data
			WHERE year = 2010) AS thin_2010
			
		ON thin_2005.country = thin_2010.country
		
WHERE (thin_2010."thinness 1-19 years" - thin_2005."thinness 1-19 years") < 0;
```

### ChatGPT Query:
```sql
-- ChatGPT Query for Question 9
SELECT country,
       "thinness 1-19 years" AS thinness_2005,
       LAG("thinness 1-19 years") OVER (ORDER BY country) AS thinness_2010,
       ("thinness 1-19 years" - LAG("thinness 1-19 years") OVER (ORDER BY country)) AS thinness_diff
FROM health_data
WHERE year IN (2005, 2010) AND ("thinness 1-19 years" - LAG("thinness 1-19 years") OVER (ORDER BY country)) < 0
ORDER BY thinness_diff DESC;
```

### Differences:
- User's query directly filters for a decrease in 'thinness 1-19 years,' while ChatGPT's query calculates the difference in the main SELECT statement.
- Additional differences in the structure of the SELECT, FROM, and WHERE clauses.

</details>

<details>
<summary><strong>10. Year when the most countries had 'Polio' vaccination coverage above 90%</strong></summary>

### User Query:
```sql
-- User Query for Question 10
SELECT COUNT(country) vaccinated_countries, year
FROM health_data
WHERE polio >= 90
GROUP BY year
ORDER BY count(country) DESC
LIMIT 5;
```

### ChatGPT Query:
```sql
-- ChatGPT Query for Question 10
SELECT COUNT(*) OVER (PARTITION BY year) AS vaccinated_countries, year
FROM health_data
WHERE polio >= 90
GROUP BY year
ORDER BY vaccinated_countries DESC
LIMIT 1;
```

### Differences:
- ChatGPT's query calculates the count of countries with 'Polio' coverage above 90% using COUNT(*) directly.
- Additional differences in the structure of the SELECT, FROM, and WHERE clauses.

</details>

<details>
<summary><strong>11. Country with the highest 'Alcohol' consumption and 'Schooling' rate above global average in 2012</strong></summary>

### User Query:
```sql
-- User Query for Question 11
WITH global_avg AS (
    SELECT AVG(schooling) AS avg_global_schooling
    FROM health_data
    WHERE year = 2012
)

SELECT hd.country,
	hd.alcohol,
	hd.schooling,
	ga.avg_global_schooling,
	hd.year
FROM health_data hd
CROSS JOIN global_avg ga
WHERE hd.year = 2012
ORDER BY hd.alcohol DESC
LIMIT 3;
```

### ChatGPT Query:
```sql
-- ChatGPT Query for Question 11
WITH global_avg AS (
    SELECT AVG(schooling) AS avg_global_schooling
    FROM health_data
    WHERE year = 2012
)

SELECT country, alcohol, schooling, year
FROM health_data
WHERE year = 2012 AND schooling > (SELECT avg_global_schooling FROM global_avg)
ORDER BY alcohol DESC
LIMIT 3;
```

### Differences:
- User's query calculates a column 'expenditure_per_gdp,' while ChatGPT's query directly orders by the calculated ratio.
- Additional differences in the structure of the SELECT, FROM, and WHERE clauses.

</details>

<details>
<summary><strong>12. Average 'Total expenditure' on healthcare as a percentage of GDP for 'Developed' countries in 2010</strong></summary>

### User Query:
```sql
-- User Query for Question 12
SELECT AVG(("Total expenditure"/gdp)*100) AS avg_expenditure_per_gdp, year
FROM health_data
WHERE year = 2010 AND status LIKE 'Developed'
GROUP BY year;
```

### ChatGPT Query:
```sql
-- ChatGPT Query for Question 12
SELECT AVG("Total expenditure" / gdp * 100) AS avg_expenditure_per_gdp, year
FROM health_data
WHERE year = 2010 AND status = 'Developed';
```

### Differences:
- ChatGPT's query simplifies the WHERE clause by using `status = 'Developed'`.
- Additional differences in the structure of the SELECT, FROM, and GROUP BY clauses.

</details>

<details>
<summary><strong>13. Countries with the largest difference between 'thinness 1-19 years' and 'thinness 5-9 years' in 2012</strong></summary>

### User Query:
```sql
-- User Query for Question 13
SELECT country,
	   ("thinness 1-19 years" - "thinness 5-9 years") thinness_diff,
	   year
FROM health_data
WHERE year = 2012
ORDER BY thinness_diff DESC
LIMIT 3;
```

### ChatGPT Query:
```sql
-- ChatGPT Query for Question 13
SELECT country,
       ("thinness 1-19 years" - "thinness 5-9 years") AS thinness_diff,
       year
FROM health_data
WHERE year = 2012
ORDER BY thinness_diff DESC
LIMIT 3;
```

### Differences:
- Both queries are structurally similar, calculating the difference and ordering by it.
- Additional differences in the structure of the SELECT, FROM, and ORDER BY clauses.

</details>

<details>
<summary><strong>14. Year when the average 'GDP' was highest for 'Developing' countries</strong></summary>

### User Query:
```sql
-- User Query for Question 14
SELECT AVG(gdp) AS avg_gdp, year
FROM health_data
WHERE status LIKE 'Developing'
GROUP BY year
ORDER BY AVG(gdp) DESC
LIMIT 3;
```

### ChatGPT Query:
```sql
-- ChatGPT Query for Question 14
SELECT year,
       AVG(gdp) AS avg_gdp
FROM health_data
WHERE status = 'Developing'
GROUP BY year
ORDER BY avg_gdp DESC
LIMIT 3;
```

### Differences:
- ChatGPT's query simplifies the WHERE clause by using `status = 'Developing'`.
- Additional differences in the structure of the SELECT, FROM, and ORDER BY clauses.

</details>

<details>
<summary><strong>15. Country with the highest 'Hepatitis B' vaccination coverage in 2013</strong></summary>

### User Query:
```sql
-- User Query for Question 15
SELECT country, "Hepatitis B", population
FROM health_data
WHERE year = 2013
ORDER BY "Hepatitis B" DESC, population DESC
LIMIT 3;
```

### ChatGPT Query:
```sql
-- ChatGPT Query for Question 15
SELECT country, "Hepatitis B", population
FROM health_data
WHERE year = 2013
ORDER BY "Hepatitis B" DESC, population DESC
LIMIT 3;
```

### Differences:
- Both queries are structurally similar, ordering by 'Hepatitis B' coverage and population.
- Additional differences in the structure of the SELECT, FROM, and ORDER BY clauses.

</details>

---
